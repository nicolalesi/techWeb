<html>
    <head> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script type="text/javascript" src="C:\Users\niky0\OneDrive\Documenti\GitHub\techWeb\q-master\q.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
          <title> Info sugli animali </title>
          <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      </head>
      <style>
        #nuovaPassword{
            display: none;
        }
      </style>
    <body>
        <div class="card text-center">
            <div class="card-header">
                <h3> Animal house</h3>
                <ul class="nav nav-tabs card-header-tabs " id="navbar">
                    <li class="nav-item">
                    <a class="nav-link" href="home.html">Home</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="scopri.html">Scopri nuovi animali</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="quiz.html">Quiz</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="curiosita.html">Curiosit√†</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="funFacts.html" tabindex="-1" aria-disabled="true">Funny and cutie images</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link active" href="login.html" tabindex="-1" aria-disabled="true">Login</a>
                    </li>
                    <li class="nav-item" id="bacheca">
                    <a class="nav-link" href="bacheca.html" tabindex="-1" aria-disabled="true">Bacheca</a>    
                    </li>
                </ul>
            </div>    
        </div>
        <div>
            <div id="divOldPassword">
                <input type="text" placeholder="Inserisci vecchia password" id="oldPassword"/>
                <input type="button" value="Invia" onclick="verificaNomeUtente()"/>
            </div>
            <div id="nuovaPassword">
                <input type="text" id="password" placeholder="inserisci nuova password"/>
                <input type="button" value="Invia" onclick="inviaNuovaPassword()"/>
            </div>
        </div>
    </body>
</html>
<script>
    var infoResponse;

    function verificaNomeUtente(){  
       var oldPassword=document.getElementById("oldPassword").value;
       if(!oldPassword)
        window.alert("Non hai inserito nulla");
       else {
        console.log(oldPassword);

        var settings = {
          "url": "http://localhost:3000/utenti/"+document.cookie,
          "method": "GET",
          "timeout": 0,
        };

        $.ajax(settings).done(function (response) {
            
            infoResponse=response;
            console.log(response);
            console.log(response.password);

            if(response.password==oldPassword){
                document.getElementById("divOldPassword").style.display="none";
                document.getElementById("nuovaPassword").style.display="block";
            }
            else{
                window.alert("Vecchia password errata");
            }
        });
       }
    }

    function inviaNuovaPassword(){

        console.log(infoResponse);

        var password=document.getElementById("password").value;
        if(!password)
            window.alert("Non hai inserito nulla");
        else {
            var settings = {
                    "url": "http://localhost:3000/utenti/"+document.cookie,
                    "method": "PUT",
                    "timeout": 0,
                    "headers": {
                    "Content-Type": "application/json"
                    },
                    "data": JSON.stringify({
                    "email": infoResponse.email,
                    "password": password,
                    "nome": infoResponse.nome,
                    "cognome":infoResponse.cognome,
                    "punteggio":infoResponse.punteggio
                    }),

                };

                $.ajax(settings).done(function (response) {
                console.log(response);
                window.alert("Password cambiata con successo");
                window.location.href="Home.html";
            });

        }    

    }
</script>