<html>
    <head> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <title> Info sugli animali </title>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    </head>
    <style>
        #divMessaggio{
            padding: 20px;
            border-radius: 20px;
            margin-top: 10px;
        }
        #casellaPosta{
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        #mittente{
            padding: 20px;
            background-color: deepskyblue;
            width: 100%;
            color: whitesmoke;
            font-weight: bold;
            border-radius: 20px;
        }
        #container{
            margin-bottom: 10px;
        }
        .title{
            font-weight: bold;
            color: cornflowerblue;
        }
    </style>
    <script>

        /*if(!document.cookie){
            console.log("Non sei loggato");
            window.alert("Non sei loggato");
            window.location.replace("login.html");
        } */   

        function logout(){
            document.cookie="null";
            window.location.replace("home.html");
        }

        if(document.cookie){
        console.log("Il cookie da questa pagina "+document.cookie);

        var settings = {
                    "url": "http://localhost:3000/utenti/"+document.cookie,
                    "method": "GET",
                    "timeout": 0,
                    };

                    $.ajax(settings).done(function (response) {

                    infoResponse=response;
                    console.log(infoResponse);

                    document.getElementById("nome").innerHTML=infoResponse.nome;
                    document.getElementById("cognome").innerHTML=infoResponse.cognome;
                    document.getElementById("nomeUtente").innerHTML=infoResponse.email;
                    document.getElementById("punteggio").innerHTML=infoResponse.punteggio;
                    
                    console.log(document.getElementById("nomeUtente").innerHTML);

                    var settings = {
                    "url": "http://localhost:3000/messaggio?destinatario="+document.getElementById("nomeUtente").innerHTML,
                    "method": "GET",
                    "timeout": 0,
                    };

                    $.ajax(settings).done(function (response) {

                    var divPosta=document.getElementById("casellaPosta");
                    for(let i=0;i<response.length;i++){
                        
                        var divMessaggio=document.createElement("div");
                        var pMittente=document.createElement("p");
                        var pMessaggio=document.createElement("p");

                        divMessaggio.id="divMessaggio";
                        divMessaggio.classList.add("border");
                        divMessaggio.classList.add("border-primary");
                        pMittente.innerHTML=response[i].mittente;
                        pMittente.id="mittente";
                        pMessaggio.innerHTML=response[i].messaggio;


                        divMessaggio.appendChild(pMittente);
                        divMessaggio.appendChild(pMessaggio);

                        divPosta.appendChild(divMessaggio);

                    }

                    });
                    });


                }

        
    </script>
    <style>
        th{
            color: blue;
        }
    </style>
    <body>
        <div class="card text-center">
            <div class="card-header">
                <h3> Animal house</h3>
                <ul class="nav nav-tabs card-header-tabs " id="navbar">
                    <li class="nav-item">
                    <a class="nav-link" href="home.html">Home</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="scopri.html">Scopri nuovi animali</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="quiz.html">Quiz</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="curiosita.html">Curiosit√†</a>
                    </li>
                    <li class="nav-item">
                    <a class="nav-link" href="funFacts.html" tabindex="-1" aria-disabled="true">Funny and cutie images</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link active" href="areaPersonale.html" tabindex="-1" aria-disabled="true">Area personale</a>
                    </li>
                    <li class="nav-item" id="bacheca">
                        <a class="nav-link" href="bacheca.html" tabindex="-1" aria-disabled="true">Bacheca</a>    
                    </li>
                </ul>
            </div>    
        </div>

        <div id="container">
            <table class="table">
                <thead class="table-primary">
                    <th> Username </td>
                    <th> Nome</td>
                    <th> Cognome</td>
                    <th> Punteggio Quiz </td>
                </thead>
                <tr>
                    <td id="nomeUtente"> Admin</td>
                    <td id="nome"> Nome </td>
                    <td id="cognome">Cognome </td>
                    <td id="punteggio"> 5</td>
                </tr>
            </table>
            <div id="casellaPosta">
                <h3 class="title"> La tua casella di posta</h3>
            </div>
            <button onclick="logout()" class="btn btn-primary">
                Logout
            </button>
            <a href="cambiaPassword.html"> Cambia password </a>
            <a href="eliminaAccount.html"> Elimina il mio account </a>
        </div>
</html>